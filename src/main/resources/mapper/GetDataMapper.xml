<?xml version="1.0" encoding="UTF-8" ?> <!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.GetDataDao">


    <resultMap id="bannerMap" type="entity.Banner">
        <id column="banner_id" property="banner_id"/>
        <result column="banner_img" property="banner_img"/>
        <result column="banner_type" property="banner_type"/>
        <result column="banner_to_class_id" property="banner_to_class_id"/>
    </resultMap>
    <select id="getBanners" resultMap="bannerMap">
        select banner_id,banner_img,banner_type,banner_to_class_id from banner order by banner_create_time desc limit 4
    </select>

    <resultMap id="classMap" type="entity.TeaClasss">
        <id column="class_id" property="selectId"/>
        <result column="class_title" property="selectlisttitle"/>
        <result column="class_author" property="selectauthor"/>
        <result column="class_price" property="selectprice"/>
        <result column="class_img" property="selectbackimg"/>
        <result column="class_view" property="selectstucount"/>
    </resultMap>
    <select id="getClasses" resultMap="classMap">
        select class_id,class_title,class_author,class_price,class_img,class_view from `class` order by class_create_time desc limit 10
    </select>
    <select id="getMoreClass" resultMap="classMap" parameterType="integer">
        select class_id,class_title,class_author,class_price,class_img,class_view from `class` order by class_create_time desc limit #{currentPage} ,10
    </select>


    <resultMap id="qaMap" type="dto.QAData">
        <id column="qa_id" property="qa_id"/>
        <result column="user_name" property="user_name"/>
        <result column="user_icon" property="user_icon"/>
        <result column="user_signal" property="user_signal"/>
        <result column="qa_user_id" property="qa_user_id"/>
        <result column="qa_content" property="qa_content"/>
        <!--<result column="qa_like" property="qa_like"/>-->
        <!--<result column="qa_comment" property="qa_comment"/>-->
        <result column="qa_video" property="qa_video"/>
        <result column="qa_audio" property="qa_audio"/>
        <result column="qa_time" property="qa_time"/>
        <result column="qa_video_cover" property="qa_video_cover"/>
    </resultMap>

    <select id="getQAData" resultMap="qaMap">

        select a.qa_id,a.qa_user_id,a.qa_content,a.qa_video,a.qa_time,a.qa_audio,b.user_id,b.user_name,b.user_icon,b.user_signal,a.qa_video_cover
        from question_answer a join `user` b on a.qa_user_id = b.user_id order by a.qa_time desc limit 15
    </select>


    <select id="getMoreQAData" resultMap="qaMap">
        select a.qa_id,a.qa_user_id,a.qa_content,a.qa_video,a.qa_time,a.qa_audio,b.user_id,b.user_name,b.user_icon,b.user_signal,a.qa_video_cover
        from question_answer a join `user` b on a.qa_user_id = b.user_id order by a.qa_time desc limit #{currentPage},15

    </select>

    <select id="getQADetail" resultMap="qaMap">
        select a.qa_id,a.qa_user_id,a.qa_content,a.qa_video,a.qa_time,a.qa_audio,b.user_id,b.user_name,b.user_icon,b.user_signal,a.qa_video_cover
        from question_answer a join `user` b on a.qa_user_id = b.user_id where a.qa_id = #{qaId}

    </select>

    <resultMap id="commentMap" type="entity.Comment">
        <id column="comment_q_id" property="comment_q_id"/>
        <result column="comment_q_qa_id" property="comment_q_qa_id"/>
        <result column="comment_q_user_id" property="comment_q_user_id"/>
        <result column="comment_q_content" property="comment_q_content"/>
        <!--<result column="comment_q_like" property="comment_q_like"/>-->
        <result column="user_name" property="user_name"/>
        <result column="user_icon" property="user_icon"/>
        <result column="comment_q_time" property="comment_q_time"/>
    </resultMap>

    <select id="getComment" resultMap="commentMap">
        select a.comment_q_id,a.comment_q_qa_id,a.comment_q_user_id,a.comment_q_content,a.comment_q_time,b.user_name,b.user_icon from comment_qa a join `user` b
         on a.comment_q_user_id = b.user_id where a.comment_q_qa_id = #{qaId} order by a.comment_q_time desc
    </select>

    <resultMap id="replyMap" type="entity.Reply">
        <id column="reply_id" property="reply_id"/>
        <result column="reply_r_id" property="reply_r_id"/>
        <result column="reply_comment" property="reply_comment"/>
        <result column="reply_user_id" property="reply_user_id"/>
        <result column="reply_to_user_id" property="reply_to_user_id"/>
        <result column="reply_like" property="reply_like"/>
        <result column="user_name" property="user_name"/>
        <result column="user_icon" property="user_icon"/>
        <result column="to_user_name" property="to_user_name"/>
        <result column="to_user_icon" property="to_user_icon"/>
        <result column="reply_time" property="reply_time"/>
    </resultMap>
    <select id="getReply" resultMap="replyMap">

        select a.reply_id,a.reply_r_id,a.reply_comment,a.reply_user_id,a.reply_to_user_id,a.reply_time,b.user_name,b.user_icon,d.user_name as to_user_name,d.user_icon as to_user_icon

        from reply a
        join `user` b on a.reply_user_id = b.user_id join `user` d on a.reply_to_user_id = d.user_id  where a.reply_r_id = #{commentId} order by a.reply_time desc
    </select>


    <select id="getSingleComment" resultMap="commentMap">
        select a.comment_q_id,a.comment_q_qa_id,a.comment_q_user_id,a.comment_q_content,a.comment_q_time,b.user_name,b.user_icon from comment_qa a join `user` b
         on a.comment_q_user_id = b.user_id where a.comment_q_id = #{commentId}
    </select>

    <select id="getQALike" resultType="integer">
        select count(*) from qa_like where qa_like_qa_id = #{qaId}
    </select>

    <select id="getCommentLike" resultType="integer">
        select count(*) from comment_like where comment_like_comment_id = #{commentId}
    </select>

    <select id="getQAComment" resultType="integer">
        select count(*) from comment_qa where comment_q_qa_id = #{qaId}
    </select>

    <select id="isLike" resultType="integer" parameterType="string">
        select isnull((select qa_like_id from `qa_like` where qa_like_qa_id = #{qaId} and qa_like_user_id = #{userId}))
    </select>

    <select id="isCommentLike" resultType="integer" parameterType="string">
        select isnull((select comment_like_id from comment_like where comment_like_comment_id = #{commentId} and comment_like_user_id = #{userId} ))
    </select>

    <select id="getReplyLike" resultType="integer">
        select count(*) from reply_like where reply_like_reply_id = #{replyId}
    </select>

    <select id="isReplyLike" resultType="integer" parameterType="string">
         select isnull((select reply_like_id from reply_like where reply_like_reply_id = #{replyId} and reply_like_user_id = #{userId}))

    </select>

    <select id="getCommentReplyCount" resultType="integer">
         select count(*) from reply where reply_r_id = #{commentId}
    </select>
</mapper>